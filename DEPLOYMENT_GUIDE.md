# Гайд по деплою бота в AppWrite

## 1. Подготовка кода
- Убедитесь, что все зависимости указаны в `requirements.txt`
- Проверьте версии библиотек, особенно `aiogram` (3.x)
- Убедитесь, что все импорты соответствуют актуальным версиям библиотек
- Проверьте наличие всех необходимых файлов в репозитории

## 2. Настройка AppWrite
### Функция
- Создайте новую функцию в AppWrite
- Установите Python 3.9 или выше
- Добавьте все необходимые переменные окружения:
  - `BOT_TOKEN` - токен вашего бота
  - `ADMIN_ID` - ID администратора
  - `OPENAI_API_KEY` - ключ API OpenAI (если используется)

### Зависимости
- Убедитесь, что все зависимости установлены в правильном порядке
- Проверьте совместимость версий библиотек
- Особое внимание уделите:
  - `aiogram` - используйте актуальные импорты для версии 3.x
  - `python-dotenv` - для работы с переменными окружения
  - `openai` - если используется

## 3. Частые проблемы и их решения
### Импорты
- `aiogram.storage` → `aiogram.fsm.storage.memory`
- `aiogram.filters.state` → `aiogram.filters`
- `aiogram.utils.logging` → используйте стандартный `logging`

### Состояния
- Убедитесь, что все состояния определены в `states.py`
- Проверьте правильность переходов между состояниями
- Используйте `StateFilter` для фильтрации состояний

### Обработка ошибок
- Добавьте обработку исключений во все асинхронные функции
- Логируйте ошибки для отладки
- Используйте try-except блоки для критических операций

## 4. Проверка после деплоя
1. Проверьте работу команды `/start`
2. Протестируйте все этапы создания свидания:
   - Выбор атмосферы
   - Выбор активности
   - Выбор финального штриха
   - Выбор даты
   - Комментарий пользователя
3. Проверьте форматирование сообщений
4. Убедитесь, что уведомления приходят администратору

## 5. Отладка
- Используйте логирование для отслеживания проблем
- Проверяйте логи в AppWrite
- Тестируйте каждое изменение перед деплоем
- Сохраняйте рабочие версии с помощью тегов Git

## 6. Рекомендации
- Создавайте теги для рабочих версий: `git tag v1.0.0`
- Документируйте все изменения
- Регулярно обновляйте зависимости
- Следите за обновлениями библиотек
- Используйте систему контроля версий для отслеживания изменений

## 7. Полезные команды
```bash
# Создание тега для рабочей версии
git tag v1.0.0
git push origin v1.0.0

# Откат к предыдущей версии
git reset --hard <commit-hash>
git push -f origin main

# Проверка статуса
git status
git log --oneline
``` 